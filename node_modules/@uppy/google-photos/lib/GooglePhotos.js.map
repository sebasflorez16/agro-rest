{"version":3,"names":["UIPlugin","ProviderViews","Provider","tokenStorage","getAllowedHosts","h","packageJson","locale","GooglePhotos","constructor","uppy","opts","type","storage","files","id","icon","focusable","width","height","viewBox","fill","d","companionAllowedHosts","companionUrl","provider","companionHeaders","companionKeysParams","companionCookiesRule","pluginId","supportsRefreshToken","defaultLocale","i18nInit","title","i18n","onFirstRender","bind","render","install","view","loadAllFiles","target","mount","uninstall","tearDown","unmount","Promise","all","fetchPreAuthToken","getFolder","state","getPluginState","length","folders","viewType","showFilter","showTitles","VERSION","version"],"sources":["GooglePhotos.tsx"],"sourcesContent":["import { UIPlugin, Uppy } from '@uppy/core'\nimport { ProviderViews } from '@uppy/provider-views'\nimport {\n  Provider,\n  tokenStorage,\n  getAllowedHosts,\n  type CompanionPluginOptions,\n} from '@uppy/companion-client'\nimport { h, type ComponentChild } from 'preact'\n\nimport type { UppyFile, Body, Meta } from '@uppy/utils/lib/UppyFile'\nimport type { UnknownProviderPluginState } from '@uppy/core/lib/Uppy.ts'\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport packageJson from '../package.json'\nimport locale from './locale.ts'\n\nexport type GooglePhotosOptions = CompanionPluginOptions\n\nexport default class GooglePhotos<\n  M extends Meta,\n  B extends Body,\n> extends UIPlugin<GooglePhotosOptions, M, B, UnknownProviderPluginState> {\n  static VERSION = packageJson.version\n\n  icon: () => h.JSX.Element\n\n  provider: Provider<M, B>\n\n  view: ProviderViews<M, B>\n\n  storage: typeof tokenStorage\n\n  files: UppyFile<M, B>[]\n\n  constructor(uppy: Uppy<M, B>, opts: GooglePhotosOptions) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.storage = this.opts.storage || tokenStorage\n    this.files = []\n    this.id = this.opts.id || 'GooglePhotos'\n    this.icon = () => (\n      <svg\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        width=\"32\"\n        height=\"32\"\n        viewBox=\"-7 -7 73 73\"\n      >\n        <g fill=\"none\" fill-rule=\"evenodd\">\n          <path d=\"M-3-3h64v64H-3z\" />\n          <g fill-rule=\"nonzero\">\n            <path\n              fill=\"#FBBC04\"\n              d=\"M14.8 13.4c8.1 0 14.7 6.6 14.7 14.8v1.3H1.3c-.7 0-1.3-.6-1.3-1.3C0 20 6.6 13.4 14.8 13.4z\"\n            />\n            <path\n              fill=\"#EA4335\"\n              d=\"M45.6 14.8c0 8.1-6.6 14.7-14.8 14.7h-1.3V1.3c0-.7.6-1.3 1.3-1.3C39 0 45.6 6.6 45.6 14.8z\"\n            />\n            <path\n              fill=\"#4285F4\"\n              d=\"M44.3 45.6c-8.2 0-14.8-6.6-14.8-14.8v-1.3h28.2c.7 0 1.3.6 1.3 1.3 0 8.2-6.6 14.8-14.8 14.8z\"\n            />\n            <path\n              fill=\"#34A853\"\n              d=\"M13.4 44.3c0-8.2 6.6-14.8 14.8-14.8h1.3v28.2c0 .7-.6 1.3-1.3 1.3-8.2 0-14.8-6.6-14.8-14.8z\"\n            />\n          </g>\n        </g>\n      </svg>\n    )\n\n    this.opts.companionAllowedHosts = getAllowedHosts(\n      this.opts.companionAllowedHosts,\n      this.opts.companionUrl,\n    )\n    this.provider = new Provider(uppy, {\n      companionUrl: this.opts.companionUrl,\n      companionHeaders: this.opts.companionHeaders,\n      companionKeysParams: this.opts.companionKeysParams,\n      companionCookiesRule: this.opts.companionCookiesRule,\n      provider: 'googlephotos',\n      pluginId: this.id,\n      supportsRefreshToken: true,\n    })\n\n    this.defaultLocale = locale\n\n    this.i18nInit()\n    this.title = this.i18n('pluginNameGooglePhotos')\n\n    this.onFirstRender = this.onFirstRender.bind(this)\n    this.render = this.render.bind(this)\n  }\n\n  install(): void {\n    this.view = new ProviderViews(this, {\n      provider: this.provider,\n      loadAllFiles: true,\n    })\n\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall(): void {\n    this.view.tearDown()\n    this.unmount()\n  }\n\n  async onFirstRender(): Promise<void> {\n    await Promise.all([\n      this.provider.fetchPreAuthToken(),\n      this.view.getFolder(),\n    ])\n  }\n\n  render(state: unknown): ComponentChild {\n    if (\n      this.getPluginState().files.length &&\n      !this.getPluginState().folders.length\n    ) {\n      return this.view.render(state, {\n        viewType: 'grid',\n        showFilter: false,\n        showTitles: false,\n      })\n    }\n    return this.view.render(state)\n  }\n}\n"],"mappings":"AAAA,SAASA,QAAQ,QAAc,YAAY;AAC3C,SAASC,aAAa,QAAQ,sBAAsB;AACpD,SACEC,QAAQ,EACRC,YAAY,EACZC,eAAe,QAEV,wBAAwB;AAC/B,SAASC,CAAC,QAA6B,QAAQ;AAK/C;AACA;AAAA,MACOC,WAAW;EAAA;AAAA;AAClB,OAAOC,MAAM,MAAM,aAAa;AAIhC,eAAe,MAAMC,YAAY,SAGvBR,QAAQ,CAAwD;EAaxES,WAAWA,CAACC,IAAgB,EAAEC,IAAyB,EAAE;IACvD,KAAK,CAACD,IAAI,EAAEC,IAAI,CAAC;IACjB,IAAI,CAACC,IAAI,GAAG,UAAU;IACtB,IAAI,CAACC,OAAO,GAAG,IAAI,CAACF,IAAI,CAACE,OAAO,IAAIV,YAAY;IAChD,IAAI,CAACW,KAAK,GAAG,EAAE;IACf,IAAI,CAACC,EAAE,GAAG,IAAI,CAACJ,IAAI,CAACI,EAAE,IAAI,cAAc;IACxC,IAAI,CAACC,IAAI,GAAG,MACVX,CAAA;MACE,eAAY,MAAM;MAClBY,SAAS,EAAC,OAAO;MACjBC,KAAK,EAAC,IAAI;MACVC,MAAM,EAAC,IAAI;MACXC,OAAO,EAAC;IAAa,GAErBf,CAAA;MAAGgB,IAAI,EAAC,MAAM;MAAC,aAAU;IAAS,GAChChB,CAAA;MAAMiB,CAAC,EAAC;IAAiB,CAAE,CAAC,EAC5BjB,CAAA;MAAG,aAAU;IAAS,GACpBA,CAAA;MACEgB,IAAI,EAAC,SAAS;MACdC,CAAC,EAAC;IAA2F,CAC9F,CAAC,EACFjB,CAAA;MACEgB,IAAI,EAAC,SAAS;MACdC,CAAC,EAAC;IAA0F,CAC7F,CAAC,EACFjB,CAAA;MACEgB,IAAI,EAAC,SAAS;MACdC,CAAC,EAAC;IAA6F,CAChG,CAAC,EACFjB,CAAA;MACEgB,IAAI,EAAC,SAAS;MACdC,CAAC,EAAC;IAA4F,CAC/F,CACA,CACF,CACA,CACN;IAED,IAAI,CAACX,IAAI,CAACY,qBAAqB,GAAGnB,eAAe,CAC/C,IAAI,CAACO,IAAI,CAACY,qBAAqB,EAC/B,IAAI,CAACZ,IAAI,CAACa,YACZ,CAAC;IACD,IAAI,CAACC,QAAQ,GAAG,IAAIvB,QAAQ,CAACQ,IAAI,EAAE;MACjCc,YAAY,EAAE,IAAI,CAACb,IAAI,CAACa,YAAY;MACpCE,gBAAgB,EAAE,IAAI,CAACf,IAAI,CAACe,gBAAgB;MAC5CC,mBAAmB,EAAE,IAAI,CAAChB,IAAI,CAACgB,mBAAmB;MAClDC,oBAAoB,EAAE,IAAI,CAACjB,IAAI,CAACiB,oBAAoB;MACpDH,QAAQ,EAAE,cAAc;MACxBI,QAAQ,EAAE,IAAI,CAACd,EAAE;MACjBe,oBAAoB,EAAE;IACxB,CAAC,CAAC;IAEF,IAAI,CAACC,aAAa,GAAGxB,MAAM;IAE3B,IAAI,CAACyB,QAAQ,CAAC,CAAC;IACf,IAAI,CAACC,KAAK,GAAG,IAAI,CAACC,IAAI,CAAC,wBAAwB,CAAC;IAEhD,IAAI,CAACC,aAAa,GAAG,IAAI,CAACA,aAAa,CAACC,IAAI,CAAC,IAAI,CAAC;IAClD,IAAI,CAACC,MAAM,GAAG,IAAI,CAACA,MAAM,CAACD,IAAI,CAAC,IAAI,CAAC;EACtC;EAEAE,OAAOA,CAAA,EAAS;IACd,IAAI,CAACC,IAAI,GAAG,IAAItC,aAAa,CAAC,IAAI,EAAE;MAClCwB,QAAQ,EAAE,IAAI,CAACA,QAAQ;MACvBe,YAAY,EAAE;IAChB,CAAC,CAAC;IAEF,MAAM;MAAEC;IAAO,CAAC,GAAG,IAAI,CAAC9B,IAAI;IAC5B,IAAI8B,MAAM,EAAE;MACV,IAAI,CAACC,KAAK,CAACD,MAAM,EAAE,IAAI,CAAC;IAC1B;EACF;EAEAE,SAASA,CAAA,EAAS;IAChB,IAAI,CAACJ,IAAI,CAACK,QAAQ,CAAC,CAAC;IACpB,IAAI,CAACC,OAAO,CAAC,CAAC;EAChB;EAEA,MAAMV,aAAaA,CAAA,EAAkB;IACnC,MAAMW,OAAO,CAACC,GAAG,CAAC,CAChB,IAAI,CAACtB,QAAQ,CAACuB,iBAAiB,CAAC,CAAC,EACjC,IAAI,CAACT,IAAI,CAACU,SAAS,CAAC,CAAC,CACtB,CAAC;EACJ;EAEAZ,MAAMA,CAACa,KAAc,EAAkB;IACrC,IACE,IAAI,CAACC,cAAc,CAAC,CAAC,CAACrC,KAAK,CAACsC,MAAM,IAClC,CAAC,IAAI,CAACD,cAAc,CAAC,CAAC,CAACE,OAAO,CAACD,MAAM,EACrC;MACA,OAAO,IAAI,CAACb,IAAI,CAACF,MAAM,CAACa,KAAK,EAAE;QAC7BI,QAAQ,EAAE,MAAM;QAChBC,UAAU,EAAE,KAAK;QACjBC,UAAU,EAAE;MACd,CAAC,CAAC;IACJ;IACA,OAAO,IAAI,CAACjB,IAAI,CAACF,MAAM,CAACa,KAAK,CAAC;EAChC;AACF;AAlHqB1C,YAAY,CAIxBiD,OAAO,GAAGnD,WAAW,CAACoD,OAAO"}
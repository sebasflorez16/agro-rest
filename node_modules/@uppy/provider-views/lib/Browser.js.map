{"version":3,"names":["h","classNames","remoteFileObjToLocal","useMemo","VirtualList","SearchFilterInput","FooterActions","Item","VIRTUAL_SHARED_DIR","ListItem","props","currentSelection","uppyFiles","viewType","isChecked","toggleCheckbox","recordShiftKeyPress","showTitles","i18n","validateRestrictions","getNextFolder","f","isFolder","id","title","name","getItemIcon","icon","event","type","isDisabled","isCheckboxDisabled","handleFolderClick","restrictionError","author","thumbnail","Boolean","Browser","folders","files","headerComponent","showBreadcrumbs","handleScroll","isLoading","showSearchFilter","search","searchTerm","clearSearch","searchOnInput","searchInputLabel","clearSearchLabel","cancel","done","noResultsLabel","virtualList","selected","length","rows","className","class","inputLabel","inputClassName","data","renderRow","rowHeight","onScroll","role","tabIndex","map"],"sources":["Browser.tsx"],"sourcesContent":["/* eslint-disable react/require-default-props */\nimport { h } from 'preact'\n\nimport classNames from 'classnames'\nimport remoteFileObjToLocal from '@uppy/utils/lib/remoteFileObjToLocal'\nimport { useMemo } from 'preact/hooks'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore untyped\nimport VirtualList from '@uppy/utils/lib/VirtualList'\nimport type { CompanionFile } from '@uppy/utils/lib/CompanionFile'\nimport type { Body, Meta, UppyFile } from '@uppy/utils/lib/UppyFile'\nimport type { I18n } from '@uppy/utils/lib/Translator'\nimport type Uppy from '@uppy/core'\nimport SearchFilterInput from './SearchFilterInput.tsx'\nimport FooterActions from './FooterActions.tsx'\nimport Item from './Item/index.tsx'\n\nconst VIRTUAL_SHARED_DIR = 'shared-with-me'\n\ntype ListItemProps<M extends Meta, B extends Body> = {\n  currentSelection: any[]\n  uppyFiles: UppyFile<M, B>[]\n  viewType: string\n  isChecked: (file: any) => boolean\n  toggleCheckbox: (event: Event, file: CompanionFile) => void\n  recordShiftKeyPress: (event: KeyboardEvent | MouseEvent) => void\n  showTitles: boolean\n  i18n: I18n\n  validateRestrictions: Uppy<M, B>['validateRestrictions']\n  getNextFolder?: (folder: any) => void\n  f: CompanionFile\n}\n\nfunction ListItem<M extends Meta, B extends Body>(props: ListItemProps<M, B>) {\n  const {\n    currentSelection,\n    uppyFiles,\n    viewType,\n    isChecked,\n    toggleCheckbox,\n    recordShiftKeyPress,\n    showTitles,\n    i18n,\n    validateRestrictions,\n    getNextFolder,\n    f,\n  } = props\n\n  if (f.isFolder) {\n    return Item<M, B>({\n      showTitles,\n      viewType,\n      i18n,\n      id: f.id,\n      title: f.name,\n      getItemIcon: () => f.icon,\n      isChecked: isChecked(f),\n      toggleCheckbox: (event: Event) => toggleCheckbox(event, f),\n      recordShiftKeyPress,\n      type: 'folder',\n      // TODO: when was this supposed to be true?\n      isDisabled: false,\n      isCheckboxDisabled: f.id === VIRTUAL_SHARED_DIR,\n      // getNextFolder always exists when f.isFolder is true\n      handleFolderClick: () => getNextFolder!(f),\n    })\n  }\n  const restrictionError = validateRestrictions(remoteFileObjToLocal(f), [\n    ...uppyFiles,\n    ...currentSelection,\n  ])\n\n  return Item<M, B>({\n    id: f.id,\n    title: f.name,\n    author: f.author,\n    getItemIcon: () =>\n      viewType === 'grid' && f.thumbnail ? f.thumbnail : f.icon,\n    isChecked: isChecked(f),\n    toggleCheckbox: (event: Event) => toggleCheckbox(event, f),\n    isCheckboxDisabled: false,\n    recordShiftKeyPress,\n    showTitles,\n    viewType,\n    i18n,\n    type: 'file',\n    isDisabled: Boolean(restrictionError) && !isChecked(f),\n    restrictionError,\n  })\n}\n\ntype BrowserProps<M extends Meta, B extends Body> = {\n  currentSelection: any[]\n  folders: CompanionFile[]\n  files: CompanionFile[]\n  uppyFiles: UppyFile<M, B>[]\n  viewType: string\n  headerComponent?: h.JSX.Element\n  showBreadcrumbs: boolean\n  isChecked: (file: any) => boolean\n  toggleCheckbox: (event: Event, file: CompanionFile) => void\n  recordShiftKeyPress: (event: KeyboardEvent | MouseEvent) => void\n  handleScroll: (event: Event) => Promise<void>\n  showTitles: boolean\n  i18n: I18n\n  validateRestrictions: Uppy<M, B>['validateRestrictions']\n  isLoading: boolean | string\n  showSearchFilter: boolean\n  search: (query: string) => void\n  searchTerm?: string | null\n  clearSearch: () => void\n  searchOnInput: boolean\n  searchInputLabel: string\n  clearSearchLabel: string\n  getNextFolder?: (folder: any) => void\n  cancel: () => void\n  done: () => void\n  noResultsLabel: string\n  virtualList?: boolean\n}\n\nfunction Browser<M extends Meta, B extends Body>(props: BrowserProps<M, B>) {\n  const {\n    currentSelection,\n    folders,\n    files,\n    uppyFiles,\n    viewType,\n    headerComponent,\n    showBreadcrumbs,\n    isChecked,\n    toggleCheckbox,\n    recordShiftKeyPress,\n    handleScroll,\n    showTitles,\n    i18n,\n    validateRestrictions,\n    isLoading,\n    showSearchFilter,\n    search,\n    searchTerm,\n    clearSearch,\n    searchOnInput,\n    searchInputLabel,\n    clearSearchLabel,\n    getNextFolder,\n    cancel,\n    done,\n    noResultsLabel,\n    virtualList,\n  } = props\n\n  const selected = currentSelection.length\n\n  const rows = useMemo(() => [...folders, ...files], [folders, files])\n\n  return (\n    <div\n      className={classNames(\n        'uppy-ProviderBrowser',\n        `uppy-ProviderBrowser-viewType--${viewType}`,\n      )}\n    >\n      {headerComponent && (\n        <div className=\"uppy-ProviderBrowser-header\">\n          <div\n            className={classNames(\n              'uppy-ProviderBrowser-headerBar',\n              !showBreadcrumbs && 'uppy-ProviderBrowser-headerBar--simple',\n            )}\n          >\n            {headerComponent}\n          </div>\n        </div>\n      )}\n\n      {showSearchFilter && (\n        <div class=\"uppy-ProviderBrowser-searchFilter\">\n          <SearchFilterInput\n            search={search}\n            searchTerm={searchTerm}\n            clearSearch={clearSearch}\n            inputLabel={searchInputLabel}\n            clearSearchLabel={clearSearchLabel}\n            inputClassName=\"uppy-ProviderBrowser-searchFilterInput\"\n            searchOnInput={searchOnInput}\n          />\n        </div>\n      )}\n\n      {(() => {\n        if (isLoading) {\n          return (\n            <div className=\"uppy-Provider-loading\">\n              <span>\n                {typeof isLoading === 'string' ? isLoading : i18n('loading')}\n              </span>\n            </div>\n          )\n        }\n\n        if (!folders.length && !files.length) {\n          return <div className=\"uppy-Provider-empty\">{noResultsLabel}</div>\n        }\n\n        if (virtualList) {\n          return (\n            <div className=\"uppy-ProviderBrowser-body\">\n              <ul className=\"uppy-ProviderBrowser-list\">\n                <VirtualList\n                  data={rows}\n                  renderRow={(f: CompanionFile) => (\n                    <ListItem\n                      currentSelection={currentSelection}\n                      uppyFiles={uppyFiles}\n                      viewType={viewType}\n                      isChecked={isChecked}\n                      toggleCheckbox={toggleCheckbox}\n                      recordShiftKeyPress={recordShiftKeyPress}\n                      showTitles={showTitles}\n                      i18n={i18n}\n                      validateRestrictions={validateRestrictions}\n                      getNextFolder={getNextFolder}\n                      f={f}\n                    />\n                  )}\n                  rowHeight={31}\n                />\n              </ul>\n            </div>\n          )\n        }\n\n        return (\n          <div className=\"uppy-ProviderBrowser-body\">\n            <ul\n              className=\"uppy-ProviderBrowser-list\"\n              onScroll={handleScroll}\n              role=\"listbox\"\n              // making <ul> not focusable for firefox\n              tabIndex={-1}\n            >\n              {rows.map((f) => (\n                <ListItem\n                  currentSelection={currentSelection}\n                  uppyFiles={uppyFiles}\n                  viewType={viewType}\n                  isChecked={isChecked}\n                  toggleCheckbox={toggleCheckbox}\n                  recordShiftKeyPress={recordShiftKeyPress}\n                  showTitles={showTitles}\n                  i18n={i18n}\n                  validateRestrictions={validateRestrictions}\n                  getNextFolder={getNextFolder}\n                  f={f}\n                />\n              ))}\n            </ul>\n          </div>\n        )\n      })()}\n\n      {selected > 0 && (\n        <FooterActions\n          selected={selected}\n          done={done}\n          cancel={cancel}\n          i18n={i18n}\n        />\n      )}\n    </div>\n  )\n}\n\nexport default Browser\n"],"mappings":"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"}